<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch 2 Mission Control</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@300;400;700;900&display=swap');
        
        :root {
            --nasa-blue: #0B3D91;
            --nasa-red: #FC3D21;
            --mission-green: #00ff41;
            --warning-orange: #FF8C42;
            --status-yellow: #FFD23F;
            --deep-space: #000814;
            --panel-dark: #001D3D;
            --text-cyan: #00F5FF;
            --accent-purple: #9A48D0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, var(--deep-space) 0%, var(--nasa-blue) 100%);
            color: var(--text-cyan);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .mission-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(90deg, var(--nasa-blue), var(--panel-dark));
            border-bottom: 3px solid var(--nasa-red);
            position: relative;
        }

        .mission-title {
            font-size: 2.5em;
            font-weight: 900;
            color: var(--text-cyan);
            text-shadow: 0 0 20px var(--text-cyan);
            margin-bottom: 5px;
        }

        .mission-subtitle {
            font-size: 1.2em;
            color: var(--nasa-red);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .mission-description {
            font-size: 0.9em;
            color: var(--warning-orange);
            font-weight: 400;
        }

        .master-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .master-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, var(--panel-dark), var(--nasa-blue));
            border: 2px solid var(--text-cyan);
            color: var(--text-cyan);
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .master-btn:hover {
            background: linear-gradient(45deg, var(--nasa-blue), var(--text-cyan));
            color: var(--deep-space);
            box-shadow: 0 0 15px var(--text-cyan);
        }

        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .panel {
            background: linear-gradient(145deg, var(--panel-dark), rgba(11, 61, 145, 0.3));
            border: 2px solid var(--text-cyan);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 245, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .panel.collapsed .panel-content {
            display: none;
        }

        .panel-header {
            background: linear-gradient(90deg, var(--nasa-red), var(--warning-orange));
            padding: 15px;
            font-weight: 700;
            font-size: 1.1em;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .panel-header:hover {
            background: linear-gradient(90deg, var(--warning-orange), var(--nasa-red));
        }

        .expand-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .collapsed .expand-icon {
            transform: rotate(-90deg);
        }

        .panel-content {
            padding: 20px;
        }

        /* Timeline Styles */
        .timeline-display {
            background: rgba(0, 20, 40, 0.8);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .current-time {
            font-size: 2.5em;
            color: var(--nasa-red);
            font-weight: 900;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 10px var(--nasa-red);
        }

        .timeline-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .timeline-btn {
            padding: 8px 15px;
            background: linear-gradient(45deg, var(--nasa-blue), var(--panel-dark));
            border: 1px solid var(--text-cyan);
            color: var(--text-cyan);
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .timeline-btn:hover {
            background: linear-gradient(45deg, var(--text-cyan), var(--nasa-blue));
            color: var(--deep-space);
        }

        .timeline-events {
            max-height: 300px;
            overflow-y: auto;
        }

        .timeline-event {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(0, 245, 255, 0.1);
            border-left: 4px solid var(--mission-green);
            border-radius: 5px;
        }

        .event-time {
            color: var(--mission-green);
            font-weight: 700;
            margin-right: 15px;
            min-width: 60px;
        }

        .event-details {
            flex: 1;
        }

        .event-location {
            color: var(--warning-orange);
            font-weight: 700;
        }

        .event-action {
            color: var(--text-cyan);
            font-size: 0.9em;
        }

        .next-event {
            background: rgba(252, 61, 33, 0.2);
            border-left-color: var(--nasa-red);
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            text-align: center;
            padding: 10px;
            background: rgba(0, 245, 255, 0.1);
            border-radius: 5px;
            border: 1px solid var(--text-cyan);
        }

        .status-label {
            color: var(--text-cyan);
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .status-value {
            color: var(--mission-green);
            font-weight: 700;
            font-size: 1.1em;
        }

        /* Navigation Styles */
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .coordinates {
            font-size: 1.2em;
            color: var(--mission-green);
            font-weight: 700;
            text-shadow: 0 0 5px var(--mission-green);
        }

        .status-lights {
            display: flex;
            gap: 8px;
        }

        .status-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--mission-green);
            box-shadow: 0 0 8px var(--mission-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--text-cyan);
            background: var(--panel-dark);
            margin-bottom: 15px;
        }

        .nav-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .nav-btn {
            padding: 12px 8px;
            background: linear-gradient(45deg, var(--panel-dark), var(--nasa-blue));
            border: 2px solid;
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.85em;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .nav-btn.center {
            border-color: var(--mission-green);
        }

        .nav-btn.route {
            border-color: var(--nasa-blue);
        }

        .nav-btn.traffic {
            border-color: var(--text-cyan);
        }

        .nav-btn.track {
            border-color: var(--accent-purple);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .nav-btn.center:hover {
            background: linear-gradient(45deg, var(--mission-green), var(--nasa-blue));
            box-shadow: 0 0 15px var(--mission-green);
        }

        .nav-btn.route:hover {
            background: linear-gradient(45deg, var(--nasa-blue), var(--text-cyan));
            box-shadow: 0 0 15px var(--nasa-blue);
        }

        .nav-btn.traffic:hover {
            background: linear-gradient(45deg, var(--text-cyan), var(--nasa-blue));
            box-shadow: 0 0 15px var(--text-cyan);
        }

        .nav-btn.track:hover {
            background: linear-gradient(45deg, var(--accent-purple), var(--nasa-blue));
            box-shadow: 0 0 15px var(--accent-purple);
        }

        .legend-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, var(--warning-orange), #ff6b1a);
            border: 2px solid var(--warning-orange);
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .legend-btn:hover {
            background: linear-gradient(45deg, #ff6b1a, var(--warning-orange));
            box-shadow: 0 0 15px var(--warning-orange);
        }

        /* Legend Modal */
        .legend-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .legend-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, var(--panel-dark), var(--nasa-blue));
            border: 3px solid var(--warning-orange);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            animation: slideIn 0.3s ease;
        }

        .legend-title {
            text-align: center;
            font-size: 1.8em;
            color: var(--warning-orange);
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--warning-orange);
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(0, 245, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid;
        }

        .legend-item.green { border-left-color: var(--mission-green); }
        .legend-item.red { border-left-color: var(--nasa-red); }
        .legend-item.orange { border-left-color: var(--warning-orange); }
        .legend-item.blue { border-left-color: var(--text-cyan); }
        .legend-item.white { border-left-color: white; }
        .legend-item.purple { border-left-color: var(--accent-purple); }

        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 15px;
            border: 2px solid white;
        }

        .legend-dot.green { background: var(--mission-green); }
        .legend-dot.red { background: var(--nasa-red); }
        .legend-dot.orange { background: var(--warning-orange); }
        .legend-dot.blue { background: var(--text-cyan); }
        .legend-dot.white { background: white; }
        .legend-dot.purple { background: var(--accent-purple); }

        .legend-text {
            color: var(--text-cyan);
            font-weight: 700;
        }

        .legend-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2em;
            color: var(--nasa-red);
            cursor: pointer;
            font-weight: 900;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translate(-50%, -60%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }

        /* Countdown Styles */
        .countdown-display {
            background: linear-gradient(135deg, var(--nasa-red), #8B0000);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid var(--nasa-red);
        }

        .countdown-time {
            font-size: 3em;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 20px var(--nasa-red);
            margin-bottom: 15px;
            font-family: 'Orbitron', monospace;
        }

        .countdown-label {
            font-size: 1.5em;
            color: var(--mission-green);
            font-weight: 700;
            margin-bottom: 20px;
        }

        .countdown-progress {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--mission-green), var(--status-yellow));
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .countdown-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .date-display {
            background: rgba(0, 245, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .date-label {
            color: var(--text-cyan);
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .date-value {
            color: var(--mission-green);
            font-weight: 700;
            font-size: 1.2em;
        }

        .countdown-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, var(--nasa-blue), var(--panel-dark));
            border: 2px solid var(--text-cyan);
            color: var(--text-cyan);
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .countdown-btn:hover {
            background: linear-gradient(45deg, var(--text-cyan), var(--nasa-blue));
            color: var(--deep-space);
            box-shadow: 0 0 15px var(--text-cyan);
        }

        /* Intel Styles */
        .intel-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: rgba(0, 245, 255, 0.1);
            border-radius: 5px;
            border-left: 4px solid var(--mission-green);
        }

        .intel-label {
            color: var(--text-cyan);
            font-weight: 400;
        }

        .intel-value {
            color: var(--mission-green);
            font-weight: 700;
        }

        .route-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .route-btn {
            padding: 10px;
            background: linear-gradient(45deg, var(--nasa-blue), var(--panel-dark));
            border: 2px solid var(--text-cyan);
            color: var(--text-cyan);
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.8em;
            transition: all 0.3s ease;
            text-align: center;
        }

        .route-btn:hover {
            background: linear-gradient(45deg, var(--text-cyan), var(--nasa-blue));
            color: var(--deep-space);
        }

        /* Stock Monitor Styles */
        .auto-refresh {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 245, 255, 0.1);
            border-radius: 5px;
        }

        .refresh-label {
            color: var(--text-cyan);
            font-weight: 700;
        }

        .refresh-toggle {
            background: var(--mission-green);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
        }

        .last-check {
            text-align: center;
            color: var(--warning-orange);
            font-weight: 700;
            margin-top: 10px;
        }

        /* Social Intelligence Styles */
        .social-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .social-item {
            text-align: center;
            padding: 15px;
            background: rgba(0, 245, 255, 0.1);
            border-radius: 8px;
            border: 1px solid var(--text-cyan);
        }

        .social-number {
            font-size: 1.5em;
            color: var(--mission-green);
            font-weight: 900;
            margin-bottom: 5px;
        }

        .social-label {
            color: var(--text-cyan);
            font-size: 0.9em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .control-grid {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .mission-title {
                font-size: 1.8em;
            }
            
            .master-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-controls {
                grid-template-columns: 1fr 1fr;
            }
            
            .countdown-time {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="mission-header">
        <div class="mission-title">🚀 SWITCH 2 MISSION CONTROL</div>
        <div class="mission-subtitle">OPERATION: NINTENDO ACQUISITION</div>
        <div class="mission-description">GARDEN-Enhanced Strategic Mission // Enhanced Command Center</div>
        
        <div class="master-controls">
            <button class="master-btn" onclick="expandAll()">📖 EXPAND ALL</button>
            <button class="master-btn" onclick="collapseAll()">📋 COLLAPSE ALL</button>
            <button class="master-btn" onclick="toggleFocusMode()">💎 FOCUS MODE</button>
        </div>
    </div>

    <div class="control-grid">
        <!-- TACTICAL TIMELINE - Position 1 -->
        <div class="panel" id="timeline-panel">
            <div class="panel-header" onclick="togglePanel('timeline-panel')">
                <span>🎯 TACTICAL TIMELINE</span>
                <span class="expand-icon">🔽</span>
            </div>
            <div class="panel-content">
                <div class="timeline-display">
                    <div class="current-time" id="current-time">16:14:58</div>
                    <div class="timeline-controls">
                        <button class="timeline-btn">NEXT ▼</button>
                        <button class="timeline-btn">RESET</button>
                    </div>
                </div>
                
                <div class="timeline-events">
                    <div class="timeline-event">
                        <div class="event-time">16:30</div>
                        <div class="event-details">
                            <div class="event-location">🎯 Best Buy</div>
                            <div class="event-action">DEPARTURE<br>READY</div>
                        </div>
                    </div>
                    
                    <div class="timeline-event">
                        <div class="event-time">19:00</div>
                        <div class="event-details">
                            <div class="event-location">🎯 Best Buy</div>
                            <div class="event-action">PREPARE FOR LAUNCH<br>QUEUE</div>
                        </div>
                    </div>
                    
                    <div class="timeline-event next-event">
                        <div class="event-time">22:00</div>
                        <div class="event-details">
                            <div class="event-location">🎯 Best Buy</div>
                            <div class="event-action">LAUNCH<br>GO</div>
                        </div>
                    </div>
                    
                    <div class="timeline-event">
                        <div class="event-time">22:45</div>
                        <div class="event-details">
                            <div class="event-location">🎮 GameStop</div>
                            <div class="event-action">DEPARTURE<br>STANDBY</div>
                        </div>
                    </div>
                    
                    <div class="timeline-event">
                        <div class="event-time">23:30</div>
                        <div class="event-details">
                            <div class="event-location">🎮 GameStop</div>
                            <div class="event-action">LAUNCH<br>GO</div>
                        </div>
                    </div>
                </div>
                
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">Next Event:</div>
                        <div class="status-value">Best Buy Departure</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Time to Next:</div>
                        <div class="status-value">T-2:16:00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TACTICAL NAVIGATION - Position 2 -->
        <div class="panel" id="navigation-panel">
            <div class="panel-header" onclick="togglePanel('navigation-panel')">
                <span>📍 TACTICAL NAVIGATION</span>
                <span class="expand-icon">🔽</span>
            </div>
            <div class="panel-content">
                <div class="nav-header">
                    <div class="coordinates" id="coordinates">38.9184° N, 76.4951° W</div>
                    <div class="status-lights">
                        <div class="status-light"></div>
                        <div class="status-light"></div>
                    </div>
                </div>
                
                <div class="map-container">
                    <div id="map" style="width: 100%; height: 100%;"></div>
                </div>
                
                <div class="nav-controls">
                    <button class="nav-btn center" onclick="centerMap()">CENTER</button>
                    <button class="nav-btn route" onclick="plotRoute()" id="routeBtn">ROUTE</button>
                    <button class="nav-btn traffic" onclick="toggleTraffic()">TRAFFIC</button>
                    <button class="nav-btn track" onclick="toggleTracking()" id="trackBtn">TRACK</button>
                </div>
                
                <button class="legend-btn" onclick="showLegend()">➕ LEGEND</button>
            </div>
        </div>

        <!-- MISSION COUNTDOWN -->
        <div class="panel" id="countdown-panel">
            <div class="panel-header" onclick="togglePanel('countdown-panel')">
                <span>⏱️ MISSION COUNTDOWN</span>
                <span class="expand-icon">🔽</span>
            </div>
            <div class="panel-content">
                <div class="countdown-display">
                    <div class="countdown-time" id="countdown">45d 00:00:00</div>
                    <div class="countdown-label">MISSION SUCCESS: 91.5%</div>
                    <div class="countdown-progress">
                        <div class="progress-bar" style="width: 91.5%"></div>
                    </div>
                </div>
                
                <div class="countdown-controls">
                    <div class="date-display">
                        <div class="date-label">LAUNCH DATE</div>
                        <div class="date-value">JUNE 5</div>
                    </div>
                    <div class="date-display">
                        <div class="date-label">STATUS</div>
                        <div class="date-value">STANDBY</div>
                    </div>
                </div>
                
                <div class="countdown-controls">
                    <button class="countdown-btn">START</button>
                    <button class="countdown-btn">HOLD</button>
                    <button class="countdown-btn">RESET</button>
                </div>
            </div>
        </div>

        <!-- ANNAPOLIS MISSION INTEL -->
        <div class="panel" id="intel-panel">
            <div class="panel-header" onclick="togglePanel('intel-panel')">
                <span>📊 ANNAPOLIS MISSION INTEL</span>
                <span class="expand-icon">🔽</span>
            </div>
            <div class="panel-content">
                <div class="intel-item">
                    <span class="intel-label">Base Location:</span>
                    <span class="intel-value">Annapolis, MD</span>
                </div>
                
                <div class="intel-item">
                    <span class="intel-label">Primary Target:</span>
                    <span class="intel-value">Best Buy (2661 Riva Rd)</span>
                </div>
                
                <div class="intel-item">
                    <span class="intel-label">Distance:</span>
                    <span class="intel-value">6.8 miles</span>
                </div>
                
                <div class="intel-item">
                    <span class="intel-label">GameStop Backup:</span>
                    <span class="intel-value">Westfield Annapolis (1.2 mi)</span>
                </div>
                
                <div class="route-buttons">
                    <button class="route-btn">📍 Best Buy Route</button>
                    <button class="route-btn">📍 GameStop Route</button>
                    <button class="route-btn">📍 Target Route</button>
                    <button class="route-btn">📍 Walmart Route</button>
                </div>
            </div>
        </div>

        <!-- STOCK MONITORING -->
        <div class="panel" id="stock-panel">
            <div class="panel-header" onclick="togglePanel('stock-panel')">
                <span>📈 STOCK MONITORING</span>
                <span class="expand-icon">🔽</span>
            </div>
            <div class="panel-content">
                <div class="auto-refresh">
                    <span class="refresh-label">Auto-Refresh:</span>
                    <button class="refresh-toggle">✅ ENABLED</button>
                </div>
                
                <div class="last-check">
                    Last Check: <span style="color: var(--mission-green);">4:14:42 PM</span>
                </div>
            </div>
        </div>

        <!-- SOCIAL INTELLIGENCE -->
        <div class="panel" id="social-panel">
            <div class="panel-header" onclick="togglePanel('social-panel')">
                <span>📱 SOCIAL INTELLIGENCE</span>
                <span class="expand-icon">🔽</span>
            </div>
            <div class="panel-content">
                <div class="social-stats">
                    <div class="social-item">
                        <div class="social-number">6</div>
                        <div class="social-label">ACCOUNTS MONITORED</div>
                    </div>
                    <div class="social-item">
                        <div class="social-number">🟢</div>
                        <div class="social-label">STATUS</div>
                    </div>
                </div>
                
                <div class="intel-item">
                    <span class="intel-label">Primary Sources:</span>
                    <span class="intel-value">6 ACCOUNTS MONITORED</span>
                </div>
                
                <div class="intel-item">
                    <span class="intel-label">Last Update:</span>
                    <span class="intel-value">4:14:42 PM</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Legend Modal -->
    <div class="legend-modal" id="legendModal">
        <div class="legend-content">
            <button class="legend-close" onclick="hideLegend()">×</button>
            <div class="legend-title">TACTICAL LEGEND</div>
            <div class="legend-items">
                <div class="legend-item green">
                    <div class="legend-dot green"></div>
                    <div class="legend-text">🟢 Best Buy (Primary target)</div>
                </div>
                <div class="legend-item red">
                    <div class="legend-dot red"></div>
                    <div class="legend-text">🔴 Target (Secondary objective)</div>
                </div>
                <div class="legend-item orange">
                    <div class="legend-dot orange"></div>
                    <div class="legend-text">🟠 Walmart (Supply resupply)</div>
                </div>
                <div class="legend-item blue">
                    <div class="legend-dot blue"></div>
                    <div class="legend-text">🔵 GameStop (Backup location)</div>
                </div>
                <div class="legend-item white">
                    <div class="legend-dot white"></div>
                    <div class="legend-text">⚪ Current Position (Live GPS)</div>
                </div>
                <div class="legend-item purple">
                    <div class="legend-dot purple"></div>
                    <div class="legend-text">🟣 Movement Trail (Track history)</div>
                </div>
            </div>
        </div>
    </div>

    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhyuJmrGlrZvz3t5z1dKjOzHwt_OwrIaU&callback=initMap">
    </script>

    <script>
        // Global variables
        let map;
        let markers = [];
        let currentLocationMarker;
        let routeLine;
        let trafficLayer;
        let isTracking = false;
        let trackingPath = [];
        let userLocation = null;
        let selectedLocation = null;
        let isSharedView = new URLSearchParams(window.location.search).has('view');

        // Location data with stock status colors
        const locations = {
            bestbuy: {
                name: "Best Buy",
                coords: { lat: 38.9615, lng: -76.5044 },
                address: "2661 Riva Road, Annapolis, MD 21401",
                phone: "(410) 266-3160",
                hours: "10:00 AM - 10:00 PM",
                services: "Nintendo Switch, Gaming, Electronics",
                category: "Primary Target",
                color: "#00ff41", // Mission green - high stock
                status: "HIGH STOCK"
            },
            target: {
                name: "Target",
                coords: { lat: 38.9644, lng: -76.5011 },
                address: "2505 Riva Road, Annapolis, MD 21401", 
                phone: "(410) 266-5857",
                hours: "8:00 AM - 10:00 PM",
                services: "Nintendo Switch, Gaming, General Retail",
                category: "Secondary Objective",
                color: "#FFD23F", // Warning yellow - medium stock
                status: "MEDIUM STOCK"
            },
            walmart: {
                name: "Walmart",
                coords: { lat: 38.9701, lng: -76.5089 },
                address: "2504 Solomon's Island Rd, Annapolis, MD 21401",
                phone: "(410) 266-9050", 
                hours: "6:00 AM - 11:00 PM",
                services: "Nintendo Switch, Gaming, Groceries",
                category: "Supply Resupply",
                color: "#FC3D21", // NASA red - low stock
                status: "LOW STOCK"
            },
            gamestop: {
                name: "GameStop",
                coords: { lat: 38.9892, lng: -76.5044 },
                address: "Westfield Annapolis, 1401 Forest Dr, Annapolis, MD 21403",
                phone: "(410) 266-6069",
                hours: "10:00 AM - 9:00 PM", 
                services: "Nintendo Switch, Gaming Specialty, Trade-ins",
                category: "Backup Location",
                color: "#00F5FF", // Text cyan - backup status
                status: "BACKUP READY"
            },
            home: {
                name: "Home Base",
                coords: { lat: 38.9184, lng: -76.4951 },
                address: "1034 Timber Creek Dr, Annapolis, MD 21403",
                phone: "Command Center",
                hours: "24/7 Operations",
                services: "Mission Control, Strategic Planning",
                category: "Command Center", 
                color: "#9A48D0", // Accent purple - home base
                status: "OPERATIONAL"
            }
        };

        // Initialize Google Maps
        function initMap() {
            const mapOptions = {
                zoom: 13,
                center: { lat: 38.9615, lng: -76.5044 },
                styles: [
                    {
                        "elementType": "geometry",
                        "stylers": [{"color": "#0a0a0a"}]
                    },
                    {
                        "elementType": "labels",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "geometry",
                        "stylers": [{"color": "#FF8C42"}]
                    },
                    {
                        "featureType": "road.arterial", 
                        "elementType": "geometry",
                        "stylers": [{"color": "#FC3D21"}]
                    },
                    {
                        "featureType": "road.local",
                        "elementType": "geometry", 
                        "stylers": [{"color": "#404040"}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [{"color": "#001D3D"}]
                    }
                ],
                disableDefaultUI: true,
                zoomControl: true,
                clickableIcons: false,
                keyboardShortcuts: false
            };

            map = new google.maps.Map(document.getElementById('map'), mapOptions);
            trafficLayer = new google.maps.TrafficLayer();
            
            // Add location markers
            addLocationMarkers();
            
            // Get user location
            getCurrentLocation();
            
            // Set up shared viewing if needed
            if (isSharedView) {
                setupSharedViewing();
            }
        }

        function addLocationMarkers() {
            Object.keys(locations).forEach(key => {
                const location = locations[key];
                
                const marker = new google.maps.Marker({
                    position: location.coords,
                    map: map,
                    title: location.name,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                        fillColor: location.color,
                        fillOpacity: 1,
                        strokeColor: '#ffffff',
                        strokeWeight: 2
                    },
                    animation: google.maps.Animation.DROP
                });

                marker.addListener('click', function() {
                    selectedLocation = location;
                    showLocationInfo(location);
                    updateRouteButton();
                });

                markers.push(marker);
            });
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        updateCoordinates();
                        addCurrentLocationMarker();
                        
                        if (!isSharedView) {
                            map.setCenter(userLocation);
                        }
                    },
                    function(error) {
                        console.log('Geolocation error:', error);
                        // Use default Annapolis location
                        userLocation = { lat: 38.9184, lng: -76.4951 };
                        updateCoordinates();
                        addCurrentLocationMarker();
                    }
                );
            }
        }

        function addCurrentLocationMarker() {
            if (currentLocationMarker) {
                currentLocationMarker.setMap(null);
            }
            
            currentLocationMarker = new google.maps.Marker({
                position: userLocation,
                map: map,
                title: "Your Location",
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 8,
                    fillColor: '#ffffff',
                    fillOpacity: 1,
                    strokeColor: '#00ff41',
                    strokeWeight: 3
                },
                zIndex: 1000
            });
        }

        function updateCoordinates() {
            if (userLocation) {
                const lat = userLocation.lat.toFixed(4);
                const lng = Math.abs(userLocation.lng).toFixed(4);
                document.getElementById('coordinates').textContent = `${lat}° N, ${lng}° W`;
            }
        }

        function showLocationInfo(location) {
            const distance = userLocation ? 
                calculateDistance(userLocation, location.coords).toFixed(1) : 'Unknown';
            const eta = distance !== 'Unknown' ? Math.round(distance * 2.5) : 'Unknown';
            
            const infoContent = `
                <div style="color: #000; font-family: Orbitron, monospace; max-width: 300px;">
                    <h3 style="color: #0B3D91; margin-bottom: 10px;">${location.name}</h3>
                    
                    <div style="background: #001D3D; color: #00F5FF; padding: 10px; margin-bottom: 10px; border-radius: 5px;">
                        <h4 style="color: #FC3D21; margin-bottom: 5px;">MISSION INTEL</h4>
                        <p><strong>Status:</strong> ${location.status}</p>
                        <p><strong>Distance:</strong> ${distance} miles</p>
                        <p><strong>ETA:</strong> ${eta} minutes</p>
                        <p><strong>Category:</strong> ${location.category}</p>
                    </div>
                    
                    <div style="background: #f0f0f0; padding: 10px; border-radius: 5px;">
                        <h4 style="color: #0B3D91; margin-bottom: 5px;">CONTACT INFO</h4>
                        <p><strong>Address:</strong> ${location.address}</p>
                        <p><strong>Phone:</strong> ${location.phone}</p>
                        <p><strong>Hours:</strong> ${location.hours}</p>
                        <p><strong>Services:</strong> ${location.services}</p>
                        
                        <div style="margin-top: 10px;">
                            <a href="tel:${location.phone}" style="display: inline-block; padding: 5px 10px; background: #FC3D21; color: white; text-decoration: none; border-radius: 3px; margin-right: 5px;">📞 Call</a>
                            <a href="grubhub://" style="display: inline-block; padding: 5px 10px; background: #FF8C42; color: white; text-decoration: none; border-radius: 3px; margin-right: 5px;">🍕 GrubHub</a>
                            <a href="doordash://" style="display: inline-block; padding: 5px 10px; background: #FC3D21; color: white; text-decoration: none; border-radius: 3px;">🚗 DoorDash</a>
                        </div>
                    </div>
                </div>
            `;

            const infoWindow = new google.maps.InfoWindow({
                content: infoContent
            });

            // Close any existing info windows
            if (window.currentInfoWindow) {
                window.currentInfoWindow.close();
            }

            infoWindow.open(map, markers.find(m => 
                m.getPosition().lat() === location.coords.lat
            ));
            
            window.currentInfoWindow = infoWindow;
        }

        function calculateDistance(pos1, pos2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (pos2.lat - pos1.lat) * Math.PI / 180;
            const dLng = (pos2.lng - pos1.lng) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(pos1.lat * Math.PI / 180) * Math.cos(pos2.lat * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Navigation controls
        function centerMap() {
            if (userLocation) {
                map.setCenter(userLocation);
                map.setZoom(14);
            }
        }

        function plotRoute() {
            if (!selectedLocation || !userLocation) {
                alert('Please click a location marker first to set your destination.');
                return;
            }

            clearRoute();

            const directionsService = new google.maps.DirectionsService();
            const request = {
                origin: userLocation,
                destination: selectedLocation.coords,
                travelMode: google.maps.TravelMode.DRIVING
            };

            directionsService.route(request, function(result, status) {
                if (status === 'OK') {
                    const directionsRenderer = new google.maps.DirectionsRenderer({
                        suppressMarkers: true,
                        polylineOptions: {
                            strokeColor: '#FC3D21',
                            strokeWeight: 4,
                            strokeOpacity: 0.8
                        }
                    });
                    directionsRenderer.setMap(map);
                    directionsRenderer.setDirections(result);
                    routeLine = directionsRenderer;
                    
                    document.getElementById('routeBtn').textContent = 'CLEAR ROUTE';
                    document.getElementById('routeBtn').onclick = clearRoute;
                }
            });
        }

        function clearRoute() {
            if (routeLine) {
                routeLine.setMap(null);
                routeLine = null;
            }
            updateRouteButton();
        }

        function updateRouteButton() {
            const btn = document.getElementById('routeBtn');
            if (selectedLocation) {
                btn.textContent = `ROUTE TO ${selectedLocation.name.toUpperCase()}`;
                btn.onclick = plotRoute;
            } else {
                btn.textContent = 'ROUTE';
                btn.onclick = () => alert('Click a location marker first');
            }
        }

        function toggleTraffic() {
            if (trafficLayer.getMap()) {
                trafficLayer.setMap(null);
            } else {
                trafficLayer.setMap(map);
            }
        }

        function toggleTracking() {
            if (isSharedView) return;
            
            isTracking = !isTracking;
            const btn = document.getElementById('trackBtn');
            
            if (isTracking) {
                btn.textContent = 'STOP';
                btn.style.background = 'linear-gradient(45deg, #FC3D21, #8B0000)';
                startTracking();
            } else {
                btn.textContent = 'TRACK';
                btn.style.background = 'linear-gradient(45deg, var(--panel-dark), var(--nasa-blue))';
                stopTracking();
            }
        }

        function startTracking() {
            if (navigator.geolocation) {
                trackingInterval = navigator.geolocation.watchPosition(
                    function(position) {
                        const newLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        updateLocation(newLocation);
                    },
                    null,
                    { enableHighAccuracy: true, maximumAge: 30000, timeout: 27000 }
                );
            }
        }

        function stopTracking() {
            if (trackingInterval) {
                navigator.geolocation.clearWatch(trackingInterval);
                trackingInterval = null;
            }
        }

        function updateLocation(newLocation) {
            // Update current location
            userLocation = newLocation;
            updateCoordinates();
            
            if (currentLocationMarker) {
                currentLocationMarker.setPosition(newLocation);
            }
            
            // Add to tracking path if moved significantly
            if (trackingPath.length === 0 || 
                calculateDistance(trackingPath[trackingPath.length - 1], newLocation) > 0.01) {
                trackingPath.push(newLocation);
                updateTrackingPath();
            }
        }

        function updateTrackingPath() {
            if (trackingPath.length > 1) {
                const path = new google.maps.Polyline({
                    path: trackingPath,
                    geodesic: true,
                    strokeColor: '#9A48D0',
                    strokeOpacity: 1.0,
                    strokeWeight: 3
                });
                path.setMap(map);
            }
        }

        function setupSharedViewing() {
            // Disable tracking for viewers
            document.getElementById('trackBtn').textContent = 'VIEW ONLY';
            document.getElementById('trackBtn').disabled = true;
            
            // Add shared viewing indicator
            const indicator = document.createElement('div');
            indicator.innerHTML = '👁️ SHARED VIEW';
            indicator.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(45deg, var(--nasa-blue), var(--text-cyan));
                color: white;
                padding: 10px;
                border-radius: 5px;
                font-weight: 700;
                z-index: 1000;
            `;
            document.body.appendChild(indicator);
        }

        // Legend controls
        function showLegend() {
            document.getElementById('legendModal').style.display = 'block';
        }

        function hideLegend() {
            document.getElementById('legendModal').style.display = 'none';
        }

        // Panel controls
        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            panel.classList.toggle('collapsed');
        }

        function expandAll() {
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('collapsed');
            });
        }

        function collapseAll() {
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.add('collapsed');
            });
        }

        function toggleFocusMode() {
            // Implementation for focus mode
            console.log('Focus mode toggled');
        }

        // Update time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour12: false });
            document.getElementById('current-time').textContent = timeString;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            // Close legend on escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideLegend();
                }
            });
            
            // Close legend on outside click
            document.getElementById('legendModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideLegend();
                }
            });
        });

        // Global tracking interval
        let trackingInterval;
    </script>
</body>
</html>